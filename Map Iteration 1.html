<!DOCTYPE html>
<html>
    <body>
        <div id="floating-panel">
            <input onclick="showAll();" type=button value="All Hospitals">
            <input onclick="showMental();" type=button value="Mental Service">
        </div>
        <div id="map" style="height: 500px;"></div>
        <script>
            var markers = [];
            var markersAll = [];
            var markersMental = [];
            var map;
            var client;
            
            var HttpClient = function() {
                this.get = function(aUrl, aCallback) {
                    var anHttpRequest = new XMLHttpRequest();
                    anHttpRequest.onreadystatechange = function() { 
                        if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
                            aCallback(anHttpRequest.responseText);
                    }
                    anHttpRequest.open( "GET", aUrl, true );            
                    anHttpRequest.send( null );
                }
            }
            
            // Initialize and add the map
            function initMap() {
                // The location of Monash Caulfield
                var monash = {lat: -37.877010, lng: 145.044266};
                // The map, centered at Monash
                map = new google.maps.Map(
                    document.getElementById('map'), {zoom: 10, center: monash});
                
                client = new HttpClient();
                mental();
                allHospital();
            }
            
            // Get data of all VIC hospitals.
            function allHospital() {
                client.get('https://sidespaceapi.azurewebsites.net/api/values', function(response) {
                    var obj = JSON.parse(response)
                    markers = [];
                    addMarker(obj);
                    markersAll = markers;
                });
            }
            
            //Get data of hospitals with mental service.
            function mental() {
                client.get('https://sidespaceapi.azurewebsites.net/api/mental', function(response) {
                    var obj = JSON.parse(response)
                    markers = [];
                    addMarker(obj);
                    markersMental = markers;
                });
            }
            
            function addMarker(obj) {
                for (var i = 0; i < obj.length; i++) {
                    var latLng = new google.maps.LatLng(obj[i].Lat,obj[i].Lon);
                    // var image = 'https://image.flaticon.com/icons/svg/119/119065.svg';

                    // Creating a marker and putting it on the map
                    var marker = new google.maps.Marker({
                        position: latLng,
                        map: map,
                        // icon: image
                    });
                    
                    var message = "<p><b>" + obj[i].HName + "</b></p>" + 
                                  "<p> Address: " + obj[i].Address + " " + obj[i].Suburb + "</p>";
                    
                    attachMessage(marker, message);
                    markers.push(marker);
                }
            }
            
            function attachMessage(marker, messaga) {
                var infoWindow = new google.maps.InfoWindow({
                    content: messaga
                });

                marker.addListener('click', function(){
                    infoWindow.open(marker.get('map'), marker);
                });
            }
            
            // Sets the map on all markers in the array.
            function setMapOnAll(map, group) {
                for (var i = 0; i < group.length; i++) {
                  group[i].setMap(map);
                }
            }

            // Shows any markers currently in the array.
            function showAll() {
                setMapOnAll(null, markers);
                setMapOnAll(map, markersAll);
            }
            
            // Deletes all markers in the array by removing references to them.
            function showMental() {
                setMapOnAll(null, markers);
                setMapOnAll(map, markersMental);
            }
        </script>

        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCOrRc4XSsptM3keW8TGT0zb5lS2PjaFzE&callback=initMap">
        </script>
    </body>
</html>